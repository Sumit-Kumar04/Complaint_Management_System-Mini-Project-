<div class="container mt-5">
  <div class="row g-4">

    <!-- Profile Card -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 p-4 position-relative text-center">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" width="100" class="mx-auto rounded-circle mb-3" alt="User Avatar">
        <h4 class="fw-bold mb-1"><%= user.name %></h4>
        <p class="text-muted mb-1">User ID: <%= user._id %></p>
        <p class="text-muted mb-3"><i class="bi bi-telephone"></i> +91 <%= user.phone %></p>

        <form action="/user/<%= user._id %>/edit">
          <button class="btn btn-primary w-100">Edit Profile</button>
        </form>
        <form action="/user/<%= user._id %>/delete" method="GET" >
                <button class="btn btn-danger w-100 mt-3" type="submit">
                  <i class="bi bi-trash"></i> Delete Account
                </button>
        </form> 
      </div>
    </div>

    <!-- Stats + Complaints -->
<div class="col-lg-8">
  <!-- Stats Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card p-3 text-center shadow-sm border-0 bg-primary text-white">
        <h6 class="mb-1">Active</h6>
        <h2 class="fw-bold"><%= stats.active %></h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 text-center shadow-sm border-0 bg-success text-white">
        <h6 class="mb-1">Resolved</h6>
        <h2 class="fw-bold"><%= stats.resolved %></h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 text-center shadow-sm border-0 bg-warning text-dark">
        <h6 class="mb-1">Pending</h6>
        <h2 class="fw-bold"><%= stats.pending %></h2>
      </div>
    </div>
  </div>

  <!-- Recent Complaints Table -->
  <div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-dark text-white fw-bold">
    Recent Complaints
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Subject</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <% if (complaints.length > 0) { %>
            <% complaints.forEach((complaint, index) => { %>
              <!-- Main Row -->
              <tr data-bs-toggle="collapse" data-bs-target="#collapse<%= index %>" style="cursor:pointer;">
                <td>#<%= index + 1 %></td>
                <td><%= complaint.subject %></td>
                <td>
                  <% if (complaint.status === "Pending") { %>
                    <span class="badge bg-warning text-dark">Pending</span>
                  <% } else if (complaint.status === "Resolved") { %>
                    <span class="badge bg-success">Resolved</span>
                  <% } else { %>
                    <span class="badge bg-primary">Active</span>
                  <% } %>
                </td>
                <td><%= complaint.createdAt.toLocaleDateString("en-IN") %></td>
              </tr>

              <!-- Expandable Details Row -->
              <tr class="collapse" id="collapse<%= index %>">
                <td colspan="4" class="bg-light">
                  <strong>Description:</strong> <%= complaint.description %><br>
                  <strong>Category:</strong> <%= complaint.category %><br>
                  <strong>Location:</strong> <%= complaint.location %>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="4" class="text-center text-muted">No complaints yet</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>



  <!-- New Complaint Button -->
  <div class="text-end">
  <form action="/user/<%=user._id%>/complaint/new" method="get">
    <button type="submit" class="btn btn-lg btn-primary">
      <i class="bi bi-plus-circle"></i> Register New Complaint
    </button>
  </form>
</div>
</div>
